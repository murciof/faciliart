<script type="module">
  import * as ArtGenerator from 'lib/art_generator'
  import * as Input from 'lib/input'
  import * as UserInterface from 'lib/user_interface'
  window.ArtGenerator = ArtGenerator
  window.Input = Input
  window.UserInterface = UserInterface
  <% if action_name == 'edit' %>
    UserInterface.update_editor_fields(JSON.parse(<%= art.data.to_json.html_safe %>))
    ArtGenerator.render_layer_buttons(JSON.parse(<%= art.data.to_json.html_safe %>))
  <% end %>
</script>
<script type="application/javascript">
  var art_editor_layer_index
</script>
<%= form_with(model: art, class: "contents") do |form| %>
  <div class="flex flex-col-reverse lg:flex-row h-screen">
    <div class="lg:w-1/3 h-1/2 lg:h-full lg:pt-16 bg-base-100">
      <div class="h-full overflow-y-auto">
        <div class="flex flex-col m-6 gap-4">
          <%= render "shared/components/flash" %>
          <div class="flex flex-col flex-1 gap-2" id="art_editor_main">
            <label class="input-group">
              <span class="input input-bordered border-r-0"><i class="ph ph-text-t text-2xl"></i></span>
              <%= form.text_field :name, class: "input input-bordered bg-base-300 w-full", placeholder: "Name" %>
            </label>
            <div class="flex flex-row gap-2">
              <label class="flex-1 input-group">
                <span class="input input-bordered border-r-0"><i class="ph ph-arrows-horizontal text-2xl"></i></span>
                <%= content_tag :input,
                class: "input input-bordered bg-base-300 w-full",
                id: "parameter-width",
                oninput: "ArtGenerator.update_general_properties(art_editor_data)",
                placeholder: "Width" do; end %>
              </label>
              <label class="flex-1 input-group">
                <span class="input input-bordered border-r-0"><i class="ph ph-arrows-vertical text-2xl"></i></span>
                <%= content_tag :input,
                class: "input input-bordered bg-base-300 w-full",
                id: "parameter-height",
                oninput: "ArtGenerator.update_general_properties(art_editor_data)",
                placeholder: "Height" do; end %>
              </label>
            </div>
            <div>
              <%= render "shared/components/input/color_picker",
                  id: "parameter-bg",
                  placeholder: "<< Background Color",
                  icon: "ph-paint-bucket" %>
            </div>
            <div class="flex flex-col gap-2" id="layers">
            </div>
            <hr class="border-t border-neutral mb-2 w-full"/>
            <%= link_to "New layer", "javascript:void(0)",
            onClick: 'UserInterface.switch_element_visibility("art_editor_main", "art_editor_generators")',
            class: "btn" %>
          </div>
          <div class="hidden flex-col flex-1 gap-2" id="art_editor_generators">
            <% ArtsController::GENERATORS.each do |generator| %>
              <%= form.radio_button :generator_type,
                  generator[:generator],
                  class: "hidden peer/" + generator[:generator], id: generator[:generator],
                  onClick: 'UserInterface.render_layer_creator("' + generator[:generator] + '")' %>
              <%= label_tag generator[:generator], generator[:generator], class: "flex btn justify-center items-center" %>
            <% end %>
            <%= link_to "Back",
                "javascript:void(0)",
                onClick: 'UserInterface.switch_element_visibility("art_editor_generators", "art_editor_main")',
                class: "btn btn-primary btn-outline" %>
          </div>
          <div class="hidden flex-col flex-1 gap-4" id="art_editor_parameters">
            <% ArtsController::GENERATORS.each do |generator| %>
              <%= content_tag :div,
                  class: "hidden flex-col gap-4",
                  id: "parameters-" + generator[:generator] do %>
                <%= content_tag :div,
                    class: "hidden text-2xl font-bold",
                    id: "art_editor_parameters_" + generator[:generator] + "_create" do %>
                  Create <%= generator[:generator] %>
                <% end %>
                <%= content_tag :div,
                    class: "hidden text-2xl font-bold",
                    id: "art_editor_parameters_" + generator[:generator] + "_edit" do %>
                  Edit <%= generator[:generator] %>
                <% end %>
                <div class="flex flex-row gap-2 items-end">
                  <%= render "shared/components/input/color_picker",
                      id: "parameter-" + generator[:generator] + "-color",
                      placeholder: "<< Color",
                      icon: "ph-palette" %>
                  <div class="flex flex-col gap-1">
                    <%= label_tag "parameter-" + generator[:generator] + "-fill-label", "Fill?",
                    class: "label-text" %>
                    <div class="flex flex-1">
                      <%= check_box_tag "parameter-" + generator[:generator] + "-fill", "fill",
                      false,
                      class: "checkbox border bg-base-300" %>
                    </div>
                  </div>
                </div>
                <% generator[:sliders].each do |slider| %>
                  <%= render "shared/components/input/slider",
                  min: slider[:min],
                  max: slider[:max],
                  value: slider[:value],
                  step: slider[:step],
                  generator: generator[:generator],
                  element: slider[:element] %>
                <% end %>
              <% end %>
            <% end %>
            <div class="flex flex-row gap-2">
              <%= link_to "Create layer",
                  "javascript:void(0)",
                  onClick: 'ArtGenerator.create_layer(art_editor_data);
                  UserInterface.switch_element_visibility("art_editor_parameters", "art_editor_main")',
                  class: "hidden flex-1",
                  id: "art_editor_create_layer" %>
              <%= link_to "Update layer", "javascript:void(0)",
                  onClick: 'ArtGenerator.update_layer(art_editor_data,art_editor_layer_index);
                  UserInterface.switch_element_visibility("art_editor_parameters", "art_editor_main")',
                  class: "hidden flex-1",
                  id: "art_editor_update_layer" %>
              <%= link_to "Back",
                  "javascript:void(0)",
                  onClick: 'UserInterface.switch_element_visibility("art_editor_parameters", "art_editor_main")',
                  class: "hidden flex-1",
                  id: "art_editor_back_to_main" %>
              <%= link_to "Back",
                  "javascript:void(0)",
                  onClick: 'UserInterface.switch_element_visibility("art_editor_parameters",
                  "art_editor_generators")',
                  class: "hidden flex-1",
                  id: "art_editor_back_to_generators" %>
            </div>
          </div>
          <div class="flex flex-col gap-1">
            <%= form.label "Data (for debugging)", class: "label-text" %>
            <%= form.text_area :data, class: "textarea textarea-bordered bg-base-300 w-full", id: "data", readonly: true %>
          </div>
          <div class="flex flex-row gap-2 w-full">
            <% if user_signed_in? %>
              <%= form.submit class: "btn btn-primary flex-1" %>
            <% else %>
              <%= form.submit class: "btn btn-primary flex-1", disabled: true %>
            <% end %>
          </div>
        </div>
      </div>
    </div>
    <div class="lg:flex-1 h-1/2 lg:h-full bg-neutral overflow-auto pt-16">
      <div class="flex justify-center items-center h-full w-full overflow-auto"><%= render "shared/components/graphics/canvas",
          art_data: [],
          id: "art_editor",
          isStatic: false,
          isSVG: false %></div>
    </div>
  </div>
<% end %>
